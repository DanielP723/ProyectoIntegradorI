
##Creaci贸n tabla usuarios
CREATE TABLE `usuarios` (
	`nombre_u` VARCHAR(64) NOT NULL COLLATE 'latin1_swedish_ci',
	`documento` BIGINT(20) NOT NULL,
	`direccion` VARCHAR(256) NOT NULL COLLATE 'latin1_swedish_ci',
	`telefono` BIGINT(20) NOT NULL,
	`correo` VARCHAR(64) NOT NULL COLLATE 'latin1_swedish_ci',
	`tipo` TINYINT(4) NOT NULL DEFAULT '0',
	`idUsuario` INT(11) NOT NULL AUTO_INCREMENT,
	`creacion` TIMESTAMP NOT NULL DEFAULT current_timestamp(),
	`modificacion` TIMESTAMP NOT NULL DEFAULT current_timestamp() ON UPDATE current_timestamp(),
	`activo` TINYINT(4) NULL DEFAULT '0',
	PRIMARY KEY (`idUsuario`) USING BTREE,
	UNIQUE INDEX `documento` (`documento`) USING BTREE
)
COLLATE='latin1_swedish_ci'
ENGINE=InnoDB
AUTO_INCREMENT=4
;

##Creaci贸n tabla productos
DROP TABLE IF EXISTS productos;
CREATE TABLE productos(

nombre_p VARCHAR(64) UNIQUE KEY NOT NULL,
descripcion VARCHAR(256) NOT NULL,
stock INT NOT NULL,
precio INT NOT NULL,
idProductos INT AUTO_INCREMENT PRIMARY KEY NOT NULL,
creacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
modificacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

##Creaci贸n tabla detalleFactura
DROP TABLE IF EXISTS detalleFactura;
CREATE TABLE detalleFactura(

precio INT NOT NULL,
cantidad INT NOT NULL,
productos_idProductos INT NOT NULL,
CONSTRAINT fk_productos FOREIGN KEY (productos_idProductos)
REFERENCES productos (idProductos),
idDetalle INT AUTO_INCREMENT PRIMARY KEY NOT NULL

);

##Creaci贸n tabla factura
DROP TABLE IF EXISTS factura;
CREATE TABLE factura(

usuario_idUsuario INT NOT NULL,
detalleFactura_idDetalle INT NOT NULL,
CONSTRAINT fk_usuario FOREIGN KEY (usuario_idUsuario)
REFERENCES usuarios (idUsuario),
CONSTRAINT fk_detalle FOREIGN KEY (detalleFactura_idDetalle)
REFERENCES detallefactura (idDetalle),
idFactura INT AUTO_INCREMENT PRIMARY KEY NOT NULL

);


##Procedimiento signUp

CREATE PROCEDURE `signupUser`(
	IN `nomb` VARCHAR(64),
	IN `dni` BIGINT,
	IN `dir` VARCHAR(64),
	IN `tel` BIGINT,
	IN `email` VARCHAR(64)
)
LANGUAGE SQL
NOT DETERMINISTIC
CONTAINS SQL
SQL SECURITY DEFINER
COMMENT ''
BEGIN
	INSERT INTO usuarios (nombre_u,documento,direccion,telefono,correo) VALUES (nomb,dni,dir,tel,email);
END

##Procedimiento delete

CREATE DEFINER=`root`@`localhost` PROCEDURE `deleteUser`(
	IN `dni` INT
)
LANGUAGE SQL
NOT DETERMINISTIC
CONTAINS SQL
SQL SECURITY DEFINER
COMMENT ''
BEGIN
UPDATE usuarios SET activo = 1 WHERE documento = dni;
END


##Vista usuarios activos 

ALTER ALGORITHM = MERGE DEFINER=`root`@`localhost` SQL SECURITY DEFINER VIEW `usuarios_activos` AS SELECT * FROM usuarios 
WHERE activo = 0  ;